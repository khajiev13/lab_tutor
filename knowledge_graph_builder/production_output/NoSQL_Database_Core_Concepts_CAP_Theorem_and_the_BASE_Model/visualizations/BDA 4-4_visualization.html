<style>
.lx-highlight { position: relative; border-radius:3px; padding:1px 2px;}
.lx-highlight .lx-tooltip {
  visibility: hidden;
  opacity: 0;
  transition: opacity 0.2s ease-in-out;
  background: #333;
  color: #fff;
  text-align: left;
  border-radius: 4px;
  padding: 6px 8px;
  position: absolute;
  z-index: 1000;
  bottom: 125%;
  left: 50%;
  transform: translateX(-50%);
  font-size: 12px;
  max-width: 240px;
  white-space: normal;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
}
.lx-highlight:hover .lx-tooltip { visibility: visible; opacity:1; }
.lx-animated-wrapper { max-width: 100%; font-family: Arial, sans-serif; }
.lx-controls {
  background: #fafafa; border: 1px solid #90caf9; border-radius: 8px;
  padding: 12px; margin-bottom: 16px;
}
.lx-button-row {
  display: flex; justify-content: center; gap: 8px; margin-bottom: 12px;
}
.lx-control-btn {
  background: #4285f4; color: white; border: none; border-radius: 4px;
  padding: 8px 16px; cursor: pointer; font-size: 13px; font-weight: 500;
  transition: background-color 0.2s;
}
.lx-control-btn:hover { background: #3367d6; }
.lx-progress-container {
  margin-bottom: 8px;
}
.lx-progress-slider {
  width: 100%; margin: 0; appearance: none; height: 6px;
  background: #ddd; border-radius: 3px; outline: none;
}
.lx-progress-slider::-webkit-slider-thumb {
  appearance: none; width: 18px; height: 18px; background: #4285f4;
  border-radius: 50%; cursor: pointer;
}
.lx-progress-slider::-moz-range-thumb {
  width: 18px; height: 18px; background: #4285f4; border-radius: 50%;
  cursor: pointer; border: none;
}
.lx-status-text {
  text-align: center; font-size: 12px; color: #666; margin-top: 4px;
}
.lx-text-window {
  font-family: monospace; white-space: pre-wrap; border: 1px solid #90caf9;
  padding: 12px; max-height: 260px; overflow-y: auto; margin-bottom: 12px;
  line-height: 1.6;
}
.lx-attributes-panel {
  background: #fafafa; border: 1px solid #90caf9; border-radius: 6px;
  padding: 8px 10px; margin-top: 8px; font-size: 13px;
}
.lx-current-highlight {
  border-bottom: 4px solid #ff4444;
  font-weight: bold;
  animation: lx-pulse 1s ease-in-out;
}
@keyframes lx-pulse {
  0% { text-decoration-color: #ff4444; }
  50% { text-decoration-color: #ff0000; }
  100% { text-decoration-color: #ff4444; }
}
.lx-legend {
  font-size: 12px; margin-bottom: 8px;
  padding-bottom: 8px; border-bottom: 1px solid #e0e0e0;
}
.lx-label {
  display: inline-block;
  padding: 2px 4px;
  border-radius: 3px;
  margin-right: 4px;
  color: #000;
}
.lx-attr-key {
  font-weight: 600;
  color: #1565c0;
  letter-spacing: 0.3px;
}
.lx-attr-value {
  font-weight: 400;
  opacity: 0.85;
  letter-spacing: 0.2px;
}

/* Add optimizations with larger fonts and better readability for GIFs */
.lx-gif-optimized .lx-text-window { font-size: 16px; line-height: 1.8; }
.lx-gif-optimized .lx-attributes-panel { font-size: 15px; }
.lx-gif-optimized .lx-current-highlight { text-decoration-thickness: 4px; }
</style>
    <div class="lx-animated-wrapper lx-gif-optimized">
      <div class="lx-attributes-panel">
        <div class="lx-legend">Highlights Legend: <span class="lx-label" style="background-color:#D2E3FC;">CONCEPT</span> <span class="lx-label" style="background-color:#C8E6C9;">TOPIC</span></div>
        <div id="attributesContainer"></div>
      </div>
      <div class="lx-text-window" id="textWindow">
        Hello everyone, I am Haiying Che, from Institute of Data Science and knowledge Engineering
School of Computer Science, in Beijing Institute of Technology, 
in this session, we discuss about <span class="lx-highlight lx-current-highlight" data-idx="0" style="background-color:#C8E6C9;">NoSQL Database 
Core concepts</span> <span class="lx-highlight" data-idx="1" style="background-color:#D2E3FC;">CAP theorem</span> and No SQL database transaction model <span class="lx-highlight" data-idx="2" style="background-color:#D2E3FC;">BASE
The big data computing system can be summarized into three categories: 
Data storing system, Data processing system, Data application system
Here we still in the scope of Data storing system.
In data storing system, there are 4 parts to accomplish different tasks, 
which is Data collection and modeling, Distributed file system, Distributed database/data warehouse and Unified Data Access Interface.
Here we still in NoSQL Database.in No SQL database, there are two important concepts, CAP theorem and No SQL database transaction model</span> BASE.
Let’s look at the CAP theorem first. 
CAP Theorem means A distributed system cannot meet 3 requirements of Consistency, Availability, and Partition tolerance at the same time. 
At most, only two of them can be satisfied at the same time.
C stands for Consistency, which means even in a distributed environment, the data of multiple storage nodes have the same data value at the same time, and all data backup updates should be synchronized
A stands for <span class="lx-highlight" data-idx="3" style="background-color:#D2E3FC;">Availability, which means client can quickly read data, return operation results within a reasonable time, and ensure that every request has a response regardless of success or failure
P stands for partition tolerance, which means that when a partition in the system cannot communicate with other nodes, it does not affect the normal operation of the rest of the system, or the error or loss of part of the system data does not affect the overall operation of the system. 
According to the CAP theorem , a distributed system can only meet two of the CAPs in the mid-run data read and write operations, but not three at the same time. 
The choice of CAP also leads to the difference between relational databases and NoSQL databases.
Let’ s watch a video about CAP Theorem .
From the video we understand why the CAP Consistency, Availability, and Partition tolerance cant be satisfied at the same time.
The diagram here  shows different product choose different combination of C, A and P.
RDBMS choose  C and A, 
CA: That is to emphasize consistency (C)</span> and availability (A), give up partition tolerance (P),
the simplest way is to put all transaction-related content on the same machine.
Obviously, this approach will seriously affect the scalability of the system. Traditional relational databases (MySQL, SQL Server, and PostgreSQL) all adopt this design principle, so they have poor scalability.
MongoDB, HBase and Redis choose C and P, 
CP: That is to emphasize consistency (C) and partition tolerance (P), give up availability (A),
when the network partition situation occurs, the affected services need to wait for the data to be consistent, so they cannot provide services to outside parties
and CouchDB， Cassandra etc. choose A and P
AP: That is to emphasize availability (A) and <span class="lx-highlight" data-idx="4" style="background-color:#D2E3FC;">partition tolerance (P), give up consistency (C), which allow the system to return inconsistent data
Now let’s learn the NoSQL characters BASE
Speaking of BASE (Basically Available, Soft-state, Eventual <span class="lx-highlight" data-idx="5" style="background-color:#D2E3FC;">consistency), I have to talk about ACID.
A database transaction has four <span class="lx-highlight" data-idx="6" style="background-color:#D2E3FC;">ACID properties</span>:
A (Atomicity): Atomicity means that the transaction must be an atomic unit of work. For data modification, either all or none of them are performed.
C (Consistency): Consistency means that when the transaction is completed, all data must be kept in a consistent state
I (Isolation): Isolation means that changes made by concurrent firms must be isolated from changes made by any other concurrent firms
D (Durability): Persistence means that after the transaction is completed, its impact on the system is permanent. This modification will be maintained even if a fatal system failure occurs
The basic meaning of BASE is Basically Available, Soft-state, and Eventual consistency:
Basically, available means that when a part of a distributed system becomes unavailable due to a problem, the other parts can still be used normally, that is, the situation where the partition fails
&quot;Soft-state&quot; is a term corresponding to &quot;hard-state&quot;. When the data stored in the database is &quot;hard state&quot;, data consistency can be guaranteed, that is, the data is always correct. &quot;Soft state&quot; means that the state can be out of sync for a period, with a certain lag
Eventual consistency means subsequent access operations temporarily can fail to read the updated data, but after a period, the updated data must eventually be read.
According to whether the subsequent operations can obtain the latest data under high-concurrency data access operations.   The types of consistency include <span class="lx-highlight" data-idx="7" style="background-color:#D2E3FC;">strong consistency</span> and <span class="lx-highlight" data-idx="8" style="background-color:#D2E3FC;">weak consistency</span>
The main difference between the two is whether the subsequent operations can obtain the latest data under high-concurrency data access operations. 
For strong consistency, after performing an update operation, other subsequent read operations can ensure that the latest updated data is read; otherwise, if it cannot be guaranteed that all subsequent reads will read the latest updated data, then it is Just weak consistency. 
Eventual consistency is just a special case of weak consistency, allowing subsequent access operations to temporarily fail to read the updated data, but after a period, the updated data must eventually be read.
7
In this session we learned two important concepts, CAP</span></span> theorem and No SQL database transaction model BASE-<span class="lx-highlight" data-idx="9" style="background-color:#D2E3FC;">Basically Available</span>, <span class="lx-highlight" data-idx="10" style="background-color:#D2E3FC;">Soft-state</span>, <span class="lx-highlight" data-idx="11" style="background-color:#D2E3FC;">Eventual consistency</span>.
thank you for your attention, if you have any question, feel free to contact me.
      </div>
      <div class="lx-controls">
        <div class="lx-button-row">
          <button class="lx-control-btn" onclick="playPause()">▶️ Play</button>
          <button class="lx-control-btn" onclick="prevExtraction()">⏮ Previous</button>
          <button class="lx-control-btn" onclick="nextExtraction()">⏭ Next</button>
        </div>
        <div class="lx-progress-container">
          <input type="range" id="progressSlider" class="lx-progress-slider"
                 min="0" max="11" value="0"
                 onchange="jumpToExtraction(this.value)">
        </div>
        <div class="lx-status-text">
          Entity <span id="entityInfo">1/12</span> |
          Pos <span id="posInfo">[190-219]</span>
        </div>
      </div>
    </div>

    <script>
      (function() {
        const extractions = [{"index": 0, "class": "TOPIC", "text": "NoSQL Database Core Concepts: CAP Theorem and the BASE Model", "color": "#C8E6C9", "startPos": 190, "endPos": 219, "beforeText": "nstitute of Data Science and knowledge Engineering\nSchool of Computer Science, in Beijing Institute of Technology, \nin this session, we discuss about ", "extractionText": "NoSQL Database \nCore concepts", "afterText": " CAP theorem and No SQL database transaction model BASE\nThe big data computing system can be summarized into three categories: \nData storing system, D", "attributesHtml": "<div><strong>class:</strong> TOPIC</div><div><strong>attributes:</strong> {}</div>"}, {"index": 1, "class": "CONCEPT", "text": "CAP Theorem", "color": "#D2E3FC", "startPos": 220, "endPos": 231, "beforeText": "nowledge Engineering\nSchool of Computer Science, in Beijing Institute of Technology, \nin this session, we discuss about NoSQL Database \nCore concepts ", "extractionText": "CAP theorem", "afterText": " and No SQL database transaction model BASE\nThe big data computing system can be summarized into three categories: \nData storing system, Data processi", "attributesHtml": "<div><strong>class:</strong> CONCEPT</div><div><strong>attributes:</strong> {<span class=\"lx-attr-key\">definition</span>: <span class=\"lx-attr-value\">A theorem stating that a distributed system cannot simultaneously satisfy all three requirements of Consistency, Availability, and Partition tolerance. At most, only two can be met at the same time.</span>}</div>"}, {"index": 2, "class": "CONCEPT", "text": "BASE Model", "color": "#D2E3FC", "startPos": 270, "endPos": 811, "beforeText": "n Beijing Institute of Technology, \nin this session, we discuss about NoSQL Database \nCore concepts CAP theorem and No SQL database transaction model ", "extractionText": "BASE\nThe big data computing system can be summarized into three categories: \nData storing system, Data processing system, Data application system\nHere we still in the scope of Data storing system.\nIn data storing system, there are 4 parts to accomplish different tasks, \nwhich is Data collection and modeling, Distributed file system, Distributed database/data warehouse and Unified Data Access Interface.\nHere we still in NoSQL Database.in No SQL database, there are two important concepts, CAP theorem and No SQL database transaction model", "afterText": " BASE.\nLet\u2019s look at the CAP theorem first. \nCAP Theorem means A distributed system cannot meet 3 requirements of Consistency, Availability, and Parti", "attributesHtml": "<div><strong>class:</strong> CONCEPT</div><div><strong>attributes:</strong> {<span class=\"lx-attr-key\">definition</span>: <span class=\"lx-attr-value\">A NoSQL database transaction model with three properties: Basically Available, Soft-state, and Eventual consistency.</span>}</div>"}, {"index": 3, "class": "CONCEPT", "text": "Availability (A in CAP)", "color": "#D2E3FC", "startPos": 1271, "endPos": 2322, "beforeText": "onment, the data of multiple storage nodes have the same data value at the same time, and all data backup updates should be synchronized\nA stands for ", "extractionText": "Availability, which means client can quickly read data, return operation results within a reasonable time, and ensure that every request has a response regardless of success or failure\nP stands for partition tolerance, which means that when a partition in the system cannot communicate with other nodes, it does not affect the normal operation of the rest of the system, or the error or loss of part of the system data does not affect the overall operation of the system. \nAccording to the CAP theorem , a distributed system can only meet two of the CAPs in the mid-run data read and write operations, but not three at the same time. \nThe choice of CAP also leads to the difference between relational databases and NoSQL databases.\nLet\u2019 s watch a video about CAP Theorem .\nFrom the video we understand why the CAP Consistency, Availability, and Partition tolerance cant be satisfied at the same time.\nThe diagram here  shows different product choose different combination of C, A and P.\nRDBMS choose  C and A, \nCA: That is to emphasize consistency (C)", "afterText": " and availability (A), give up partition tolerance (P),\nthe simplest way is to put all transaction-related content on the same machine.\nObviously, thi", "attributesHtml": "<div><strong>class:</strong> CONCEPT</div><div><strong>attributes:</strong> {<span class=\"lx-attr-key\">definition</span>: <span class=\"lx-attr-value\">A client can quickly read data and receive operation results within a reasonable time, ensuring that every request gets a response, regardless of success or failure.</span>}</div>"}, {"index": 4, "class": "CONCEPT", "text": "Partition Tolerance (P in CAP)", "color": "#D2E3FC", "startPos": 3058, "endPos": 5550, "beforeText": "nsistent, so they cannot provide services to outside parties\nand CouchDB\uff0c Cassandra etc. choose A and P\nAP: That is to emphasize availability (A) and ", "extractionText": "partition tolerance (P), give up consistency (C), which allow the system to return inconsistent data\nNow let\u2019s learn the NoSQL characters BASE\nSpeaking of BASE (Basically Available, Soft-state, Eventual consistency), I have to talk about ACID.\nA database transaction has four ACID properties:\nA (Atomicity): Atomicity means that the transaction must be an atomic unit of work. For data modification, either all or none of them are performed.\nC (Consistency): Consistency means that when the transaction is completed, all data must be kept in a consistent state\nI (Isolation): Isolation means that changes made by concurrent firms must be isolated from changes made by any other concurrent firms\nD (Durability): Persistence means that after the transaction is completed, its impact on the system is permanent. This modification will be maintained even if a fatal system failure occurs\nThe basic meaning of BASE is Basically Available, Soft-state, and Eventual consistency:\nBasically, available means that when a part of a distributed system becomes unavailable due to a problem, the other parts can still be used normally, that is, the situation where the partition fails\n&quot;Soft-state&quot; is a term corresponding to &quot;hard-state&quot;. When the data stored in the database is &quot;hard state&quot;, data consistency can be guaranteed, that is, the data is always correct. &quot;Soft state&quot; means that the state can be out of sync for a period, with a certain lag\nEventual consistency means subsequent access operations temporarily can fail to read the updated data, but after a period, the updated data must eventually be read.\nAccording to whether the subsequent operations can obtain the latest data under high-concurrency data access operations. \u00a0 The types of consistency include strong consistency and weak consistency\nThe main difference between the two is whether the subsequent operations can obtain the latest data under high-concurrency data access operations. \nFor strong consistency, after performing an update operation, other subsequent read operations can ensure that the latest updated data is read; otherwise, if it cannot be guaranteed that all subsequent reads will read the latest updated data, then it is Just weak consistency. \nEventual consistency is just a special case of weak consistency, allowing subsequent access operations to temporarily fail to read the updated data, but after a period, the updated data must eventually be read.\n7\nIn this session we learned two important concepts, CAP", "afterText": " theorem and No SQL database transaction model BASE-Basically Available, Soft-state, Eventual consistency.\nthank you for your attention, if you have a", "attributesHtml": "<div><strong>class:</strong> CONCEPT</div><div><strong>attributes:</strong> {<span class=\"lx-attr-key\">definition</span>: <span class=\"lx-attr-value\">The system continues to operate normally even when a partition cannot communicate with other nodes, or when the error or loss of some system data does not affect the overall system operation.</span>}</div>"}, {"index": 5, "class": "CONCEPT", "text": "Consistency (C in CAP)", "color": "#D2E3FC", "startPos": 3261, "endPos": 5550, "beforeText": "ch allow the system to return inconsistent data\nNow let\u2019s learn the NoSQL characters BASE\nSpeaking of BASE (Basically Available, Soft-state, Eventual ", "extractionText": "consistency), I have to talk about ACID.\nA database transaction has four ACID properties:\nA (Atomicity): Atomicity means that the transaction must be an atomic unit of work. For data modification, either all or none of them are performed.\nC (Consistency): Consistency means that when the transaction is completed, all data must be kept in a consistent state\nI (Isolation): Isolation means that changes made by concurrent firms must be isolated from changes made by any other concurrent firms\nD (Durability): Persistence means that after the transaction is completed, its impact on the system is permanent. This modification will be maintained even if a fatal system failure occurs\nThe basic meaning of BASE is Basically Available, Soft-state, and Eventual consistency:\nBasically, available means that when a part of a distributed system becomes unavailable due to a problem, the other parts can still be used normally, that is, the situation where the partition fails\n&quot;Soft-state&quot; is a term corresponding to &quot;hard-state&quot;. When the data stored in the database is &quot;hard state&quot;, data consistency can be guaranteed, that is, the data is always correct. &quot;Soft state&quot; means that the state can be out of sync for a period, with a certain lag\nEventual consistency means subsequent access operations temporarily can fail to read the updated data, but after a period, the updated data must eventually be read.\nAccording to whether the subsequent operations can obtain the latest data under high-concurrency data access operations. \u00a0 The types of consistency include strong consistency and weak consistency\nThe main difference between the two is whether the subsequent operations can obtain the latest data under high-concurrency data access operations. \nFor strong consistency, after performing an update operation, other subsequent read operations can ensure that the latest updated data is read; otherwise, if it cannot be guaranteed that all subsequent reads will read the latest updated data, then it is Just weak consistency. \nEventual consistency is just a special case of weak consistency, allowing subsequent access operations to temporarily fail to read the updated data, but after a period, the updated data must eventually be read.\n7\nIn this session we learned two important concepts, CAP", "afterText": " theorem and No SQL database transaction model BASE-Basically Available, Soft-state, Eventual consistency.\nthank you for your attention, if you have a", "attributesHtml": "<div><strong>class:</strong> CONCEPT</div><div><strong>attributes:</strong> {<span class=\"lx-attr-key\">definition</span>: <span class=\"lx-attr-value\">In a distributed environment, the data of multiple storage nodes have the same data value at the same time, and all data backup updates should be synchronized.</span>}</div>"}, {"index": 6, "class": "CONCEPT", "text": "ACID Properties", "color": "#D2E3FC", "startPos": 3334, "endPos": 3349, "beforeText": " characters BASE\nSpeaking of BASE (Basically Available, Soft-state, Eventual consistency), I have to talk about ACID.\nA database transaction has four ", "extractionText": "ACID properties", "afterText": ":\nA (Atomicity): Atomicity means that the transaction must be an atomic unit of work. For data modification, either all or none of them are performed.", "attributesHtml": "<div><strong>class:</strong> CONCEPT</div><div><strong>attributes:</strong> {<span class=\"lx-attr-key\">definition</span>: <span class=\"lx-attr-value\">A set of four properties for database transactions: Atomicity (all or none of the work is performed), Consistency (data remains in a consistent state), Isolation (concurrent transactions are isolated from each other), and Durability (completed transactions are permanent).</span>}</div>"}, {"index": 7, "class": "CONCEPT", "text": "Strong Consistency", "color": "#D2E3FC", "startPos": 4817, "endPos": 4835, "beforeText": "ing to whether the subsequent operations can obtain the latest data under high-concurrency data access operations. \u00a0 The types of consistency include ", "extractionText": "strong consistency", "afterText": " and weak consistency\nThe main difference between the two is whether the subsequent operations can obtain the latest data under high-concurrency data ", "attributesHtml": "<div><strong>class:</strong> CONCEPT</div><div><strong>attributes:</strong> {<span class=\"lx-attr-key\">definition</span>: <span class=\"lx-attr-value\">After an update operation, any subsequent read operation is guaranteed to read the latest updated data.</span>}</div>"}, {"index": 8, "class": "CONCEPT", "text": "Weak Consistency", "color": "#D2E3FC", "startPos": 4840, "endPos": 4856, "beforeText": "equent operations can obtain the latest data under high-concurrency data access operations. \u00a0 The types of consistency include strong consistency and ", "extractionText": "weak consistency", "afterText": "\nThe main difference between the two is whether the subsequent operations can obtain the latest data under high-concurrency data access operations. \nF", "attributesHtml": "<div><strong>class:</strong> CONCEPT</div><div><strong>attributes:</strong> {<span class=\"lx-attr-key\">definition</span>: <span class=\"lx-attr-value\">A consistency model where it cannot be guaranteed that all subsequent read operations will read the latest updated data.</span>}</div>"}, {"index": 9, "class": "CONCEPT", "text": "Basically Available", "color": "#D2E3FC", "startPos": 5602, "endPos": 5621, "beforeText": "the updated data must eventually be read.\n7\nIn this session we learned two important concepts, CAP theorem and No SQL database transaction model BASE-", "extractionText": "Basically Available", "afterText": ", Soft-state, Eventual consistency.\nthank you for your attention, if you have any question, feel free to contact me.", "attributesHtml": "<div><strong>class:</strong> CONCEPT</div><div><strong>attributes:</strong> {<span class=\"lx-attr-key\">definition</span>: <span class=\"lx-attr-value\">When a part of a distributed system becomes unavailable, the other parts can still be used normally.</span>}</div>"}, {"index": 10, "class": "CONCEPT", "text": "Soft-state", "color": "#D2E3FC", "startPos": 5623, "endPos": 5633, "beforeText": " eventually be read.\n7\nIn this session we learned two important concepts, CAP theorem and No SQL database transaction model BASE-Basically Available, ", "extractionText": "Soft-state", "afterText": ", Eventual consistency.\nthank you for your attention, if you have any question, feel free to contact me.", "attributesHtml": "<div><strong>class:</strong> CONCEPT</div><div><strong>attributes:</strong> {<span class=\"lx-attr-key\">definition</span>: <span class=\"lx-attr-value\">A state where data can be out of sync for a period, with a certain lag, as opposed to a &#x27;hard-state&#x27; where data is always correct.</span>}</div>"}, {"index": 11, "class": "CONCEPT", "text": "Eventual Consistency", "color": "#D2E3FC", "startPos": 5635, "endPos": 5655, "beforeText": "be read.\n7\nIn this session we learned two important concepts, CAP theorem and No SQL database transaction model BASE-Basically Available, Soft-state, ", "extractionText": "Eventual consistency", "afterText": ".\nthank you for your attention, if you have any question, feel free to contact me.", "attributesHtml": "<div><strong>class:</strong> CONCEPT</div><div><strong>attributes:</strong> {<span class=\"lx-attr-key\">definition</span>: <span class=\"lx-attr-value\">A type of weak consistency where subsequent access operations may temporarily fail to read updated data, but after a period, the updated data must eventually be read.</span>}</div>"}];
        let currentIndex = 0;
        let isPlaying = false;
        let animationInterval = null;
        let animationSpeed = 1.0;

        function updateDisplay() {
          const extraction = extractions[currentIndex];
          if (!extraction) return;

          document.getElementById('attributesContainer').innerHTML = extraction.attributesHtml;
          document.getElementById('entityInfo').textContent = (currentIndex + 1) + '/' + extractions.length;
          document.getElementById('posInfo').textContent = '[' + extraction.startPos + '-' + extraction.endPos + ']';
          document.getElementById('progressSlider').value = currentIndex;

          const playBtn = document.querySelector('.lx-control-btn');
          if (playBtn) playBtn.textContent = isPlaying ? '⏸ Pause' : '▶️ Play';

          const prevHighlight = document.querySelector('.lx-text-window .lx-current-highlight');
          if (prevHighlight) prevHighlight.classList.remove('lx-current-highlight');
          const currentSpan = document.querySelector('.lx-text-window span[data-idx="' + currentIndex + '"]');
          if (currentSpan) {
            currentSpan.classList.add('lx-current-highlight');
            currentSpan.scrollIntoView({block: 'center', behavior: 'smooth'});
          }
        }

        function nextExtraction() {
          currentIndex = (currentIndex + 1) % extractions.length;
          updateDisplay();
        }

        function prevExtraction() {
          currentIndex = (currentIndex - 1 + extractions.length) % extractions.length;
          updateDisplay();
        }

        function jumpToExtraction(index) {
          currentIndex = parseInt(index);
          updateDisplay();
        }

        function playPause() {
          if (isPlaying) {
            clearInterval(animationInterval);
            isPlaying = false;
          } else {
            animationInterval = setInterval(nextExtraction, animationSpeed * 1000);
            isPlaying = true;
          }
          updateDisplay();
        }

        window.playPause = playPause;
        window.nextExtraction = nextExtraction;
        window.prevExtraction = prevExtraction;
        window.jumpToExtraction = jumpToExtraction;

        updateDisplay();
      })();
    </script>